# SIFT Toolbox - Client/Server Edition: Backlog for GitHub Issues

This backlog is intended to be parsed by the `github_issues.rb` script.
To use the `Full Body` column for issue bodies, the script needs modification.

## Task Table

| Task ID | Main Grouping                      | Category                 | Description                                                              | Full Body                                                                                                                                                                                        | Milestone                              | Status      |
|:--------|:-----------------------------------|:-------------------------|:-------------------------------------------------------------------------|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:---------------------------------------|:------------|
| GHI-1   | EPIC 1: Backend Foundation & Setup | API Endpoint             | Implement health check                                                   | Create a basic API endpoint at `/api/health` that returns a simple JSON success message (e.g., `{"status": "ok"}`) to confirm the server is running and accessible.                              | Backend Core & SIFT Initiation MVP     | Closed      |
| GHI-2   | EPIC 1: Backend Foundation & Setup | CORS Configuration       | Configure Sinatra for frontend communication                             | Implement CORS configuration in the Sinatra application to allow requests from the frontend's origin (e.g., `http://localhost:5173`).                                                            | Backend Core & SIFT Initiation MVP     | Closed      |
| GHI-3   | EPIC 1: Backend Foundation & Setup | API Key Management       | Finalize secure API key access pattern                                   | Ensure API keys (loaded from ENV vars) are securely and consistently accessed by service classes, using the `Config` module.                                                                     | Backend Core & SIFT Initiation MVP     | Closed      |
| GHI-4   | EPIC 2: Core SIFT Functionality    | Prompt Management        | Implement YAML/tty-config/ERB prompt system                              | Store structured AI prompts/agent configurations in YAML files. Use `tty-config` to load them and `ERB` for dynamic value templating.                                                            | Backend Core & SIFT Initiation MVP     | Pending     |
| GHI-5   | EPIC 2: Core SIFT Functionality    | Persistence              | Store initial SIFT reports & messages                                    | On successful completion of an initial SIFT analysis stream (`/api/sift/initiate`), persist the full report and initial user/AI messages to PostgreSQL via Sequel.                               | Backend Core & SIFT Initiation MVP     | Pending     |
| GHI-6   | EPIC 2: Core SIFT Functionality    | Model Configuration      | Finalize backend model config endpoint                                   | Complete the `/api/models/config` endpoint to serve AI model configurations derived from `ruby_llm.models` merged with SIFT UI parameters and custom flags.                                      | Backend Core & SIFT Initiation MVP     | Closed      |
| GHI-7   | EPIC 2: Core SIFT Functionality    | Model Configuration      | Finalize client model config fetching                                    | Ensure the client-side (`App.tsx`/`Sidebar.tsx`) correctly fetches and utilizes model configurations from the `/api/models/config` backend endpoint.                                             | Backend Core & SIFT Initiation MVP     | Closed      |
| GHI-8   | EPIC 2: Core SIFT Functionality    | Image Handling           | Finalize client image upload for SIFT initiation                         | Verify and complete the client-side image upload flow in `InputForm.tsx` ensuring the `File` object is correctly passed to `apiClient.ts` for backend processing.                                | Backend Core & SIFT Initiation MVP     | Closed      |
| GHI-9   | EPIC 2: Core SIFT Functionality    | Chat Follow-up (Backend) | Create `/api/sift/chat` endpoint                                         | Implement the Sinatra `POST /api/sift/chat` endpoint to parse incoming follow-up messages, chat history, and other parameters.                                                                   | Conversational SIFT & Full Persistence | Closed      |
| GHI-10  | EPIC 2: Core SIFT Functionality    | Chat Follow-up (Backend) | Adapt `AIService` for conversational history                             | Modify the `AIService` to use `ruby_llm`'s capabilities for handling conversational history when processing follow-up messages.                                                                  | Conversational SIFT & Full Persistence | Pending     |
| GHI-11  | EPIC 2: Core SIFT Functionality    | Chat Follow-up (Backend) | Finalize SSE streaming for `/api/sift/chat`                              | Ensure full SSE streaming functionality for `/api/sift/chat`, including data chunks, error events, and completion events.                                                                        | Conversational SIFT & Full Persistence | Closed      |
| GHI-12  | EPIC 2: Core SIFT Functionality    | Chat Follow-up (Client)  | Implement `apiClient.sendChatMessage`                                    | Create the method in `apiClient.ts` to send follow-up chat messages to the `/api/sift/chat` backend endpoint (POST JSON, expects stream URL + stream ID).                                        | Conversational SIFT & Full Persistence | Closed      |
| GHI-13  | EPIC 2: Core SIFT Functionality    | Chat Follow-up (Client)  | Refactor `App.tsx#handleSendChatMessage`                                 | Update `handleSendChatMessage` in `App.tsx` to use the new `apiClient.sendChatMessage` method.                                                                                                   | Conversational SIFT & Full Persistence | Pending     |
| GHI-14  | EPIC 2: Core SIFT Functionality    | Chat Follow-up (Client)  | Ensure SSE handling for chat follow-ups                                  | Verify that the existing SSE event handling logic in `App.tsx` correctly processes streamed responses for follow-up chat messages.                                                               | Conversational SIFT & Full Persistence | In Progress |
| GHI-15  | EPIC 2: Core SIFT Functionality    | Persistence              | Store follow-up chat messages                                            | Implement logic to persist follow-up user and AI messages from `/api/sift/chat` to PostgreSQL, linked to the initial SIFT analysis.                                                              | Conversational SIFT & Full Persistence | Pending     |
| GHI-16  | EPIC 2: Core SIFT Functionality    | Cancellation (Backend)   | Create `/api/sift/cancel/:stream_id` endpoint                            | Implement the Sinatra endpoint that client can call to request cancellation of an active stream.                                                                                                 | Conversational SIFT & Full Persistence | Pending     |
| GHI-17  | EPIC 2: Core SIFT Functionality    | Cancellation (Backend)   | Implement stream cancellation logic in `AIService`                       | Add mechanisms to `AIService` and SSE streaming to attempt to stop ongoing AI calls (timeout/abort) and close the stream upon request.                                                           | Conversational SIFT & Full Persistence | Pending     |
| GHI-18  | EPIC 2: Core SIFT Functionality    | Cancellation (Client)    | `apiClient.ts` method for cancellation                                   | Create a method in `apiClient.ts` to call the backend's `/api/sift/cancel/:stream_id` endpoint.                                                                                                  | Conversational SIFT & Full Persistence | Pending     |
| GHI-19  | EPIC 2: Core SIFT Functionality    | Cancellation (Client)    | UI for stream cancellation                                               | Add a button or UI element in `App.tsx` to allow users to trigger stream cancellation via the `apiClient`.                                                                                       | Conversational SIFT & Full Persistence | Pending     |
| GHI-20  | EPIC 3: URL Content Extraction     | API Endpoint (Backend)   | Create `/api/url/extract`                                                | Implement the Sinatra `POST /api/url/extract` endpoint that accepts a URL and returns its main textual content.                                                                                  | URL Processing & Basic Semantic Search | Pending     |
| GHI-21  | EPIC 3: URL Content Extraction     | Service (Backend)        | Implement URL fetching & parsing service                                 | Create a Ruby service using `Nokogiri` (or similar) to fetch HTML from a URL and extract relevant textual content.                                                                               | URL Processing & Basic Semantic Search | Pending     |
| GHI-22  | EPIC 3: URL Content Extraction     | UI/Client Integration    | Implement client-side URL submission & display                           | Develop UI components in the React client for users to input a URL, call the backend API via `apiClient`, and display the extracted content.                                                     | URL Processing & Basic Semantic Search | Pending     |
| GHI-23  | EPIC 3: URL Content Extraction     | Persistence (Backend)    | Store extracted URL content                                              | Save fetched URL content, title, and other metadata to a PostgreSQL table.                                                                                                                       | URL Processing & Basic Semantic Search | Pending     |
| GHI-24  | EPIC 4: Semantic Search            | Embedding Service        | Create `EmbeddingService` using `ruby_llm.embed`                         | Implement a backend service to generate vector embeddings for text (e.g., extracted URL content) using `ruby_llm.embed`.                                                                         | URL Processing & Basic Semantic Search | Pending     |
| GHI-25  | EPIC 4: Semantic Search            | Embedding Storage        | Store embeddings for URL content                                         | Add a `vector` column (pgvector) to the `processed_urls` table and store the generated embeddings.                                                                                               | URL Processing & Basic Semantic Search | Pending     |
| GHI-26  | EPIC 4: Semantic Search            | Search API Endpoint      | Create `/api/search/semantic` for URL content                            | Implement the Sinatra endpoint that accepts a search query and returns semantically similar processed URL content.                                                                               | URL Processing & Basic Semantic Search | Pending     |
| GHI-27  | EPIC 4: Semantic Search            | Search Logic (Backend)   | Implement pgvector similarity search for URLs                            | Add logic to query PostgreSQL/pgvector to find documents whose embeddings are most similar to a query embedding.                                                                                 | URL Processing & Basic Semantic Search | Pending     |
| GHI-28  | EPIC 4: Semantic Search            | UI/Client Integration    | Implement client-side semantic search for URLs                           | Develop UI components for semantic search input, calling the backend API via `apiClient`, and displaying results from URL content.                                                               | URL Processing & Basic Semantic Search | Pending     |
| GHI-29  | EPIC 4: Semantic Search            | Advanced Embeddings      | Embed SIFT report chunks                                                 | Implement functionality to break down SIFT analysis reports into manageable chunks and generate embeddings for each chunk.                                                                       | Advanced Features & Refinements        | Pending     |
| GHI-30  | EPIC 4: Semantic Search            | Advanced Search API      | Expand semantic search scope                                             | Modify the `/api/search/semantic` endpoint and backend logic to search across both processed URLs and SIFT report chunks.                                                                        | Advanced Features & Refinements        | Pending     |
| GHI-31  | EPIC 4: Semantic Search            | Advanced Search UI       | Enhance client search UI                                                 | Update the client-side search interface to handle and display results from different content types (URLs, SIFT reports).                                                                         | Advanced Features & Refinements        | Pending     |
| GHI-32  | EPIC 5: Verification Features      | Initial Implementation   | Define scope & implement V1 verification features                        | Scope, design, and implement the first version of text/claim verification features (backend logic and client UI).                                                                                | Advanced Features & Refinements        | Pending     |
| GHI-33  | EPIC 6: NFRs & Chores              | Dependencies (Client)    | Update frontend dependencies                                             | Review and update all frontend dependencies (npm packages) to their latest stable and secure versions.                                                                                           | Advanced Features & Refinements        | Pending     |
| GHI-34  | EPIC 6: NFRs & Chores              | Shared Types             | Define/sync types between client & backend                               | Establish a clear system for defining and synchronizing shared data structures (types/interfaces) between the TypeScript frontend and Ruby backend.                                              | Advanced Features & Refinements        | Pending     |
| GHI-35  | EPIC 6: NFRs & Chores              | Testing (Backend)        | Implement backend unit/integration tests                                 | Write unit and integration tests for critical backend services, especially AI interactions, database operations, and API endpoints.                                                              | Advanced Features & Refinements        | Pending     |
| GHI-36  | EPIC 6: NFRs & Chores              | Documentation            | Create backend & API documentation                                       | Document API endpoints, backend setup procedures, environment variable configurations, and deployment process.                                                                                   | Advanced Features & Refinements        | Pending     |
| GHI-37  | EPIC 2: Core SIFT Functionality    | Persistence              | Add embedding column to messages table                                   | Modify the database schema to add a `vector` column (using pgvector) to the table storing chat messages to store their embeddings.                                                               | Conversational SIFT & Full Persistence | Pending     |
| GHI-38  | EPIC 2: Core SIFT Functionality    | Embedding Generation     | Generate embeddings for chat messages                                    | Implement logic to generate embeddings for each incoming user message and AI response using the `EmbeddingService` (GHI-24) before storing them.                                                 | Conversational SIFT & Full Persistence | Pending     |
| GHI-39  | EPIC 2: Core SIFT Functionality    | Context Retrieval        | Implement semantic search for conversational history                     | Create a function or service that performs a pgvector similarity search (using GHI-27) on the chat message embeddings to find relevant past messages based on the current user input.            | Conversational SIFT & Full Persistence | Pending     |
| GHI-40  | EPIC 2: Core SIFT Functionality    | Context Integration      | Integrate retrieved context into AIService calls                         | Modify the `/api/sift/chat` endpoint (GHI-9) to retrieve relevant conversational context (GHI-39) and pass it to the `AIService` (GHI-10) when processing follow-up messages.                    | Conversational SIFT & Full Persistence | Pending     |
| GHI-41  | EPIC 2: Core SIFT Functionality    | Context Selection Logic  | Refine logic for selecting relevant context messages                     | Develop and refine strategies for selecting the most relevant messages from the semantic search results, considering factors like similarity score, recency, and conversation turns.             | Conversational SIFT & Full Persistence | Pending     |
| GHI-42  | EPIC 2: Core SIFT Functionality    | Prompt Engineering       | Update AI prompts to utilize conversational context                      | Modify the prompts used by the `AIService` (GHI-10) to effectively incorporate the provided conversational history context and guide the AI's responses.                                         | Conversational SIFT & Full Persistence | Pending     |
| GHI-43  | EPIC 2: Core SIFT Functionality    | Topic Modeling (Backend) | Implement topic modeling for conversational history (Optional)           | Implement functionality to perform topic modeling on chat history to identify key themes and potentially use this information to refine context retrieval.                                       | Advanced Features & Refinements        | Pending     |
| GHI-44  | EPIC 2: Core SIFT Functionality    | Context Retrieval        | Incorporate topic information into context retrieval (Optional)          | If GHI-43 is implemented, modify the context retrieval logic (GHI-39) to use topic information to prioritize or filter relevant messages.                                                        | Advanced Features & Refinements        | Pending     |
| GHI-45  | EPIC 7: Export Features            | PDF Export               | Implement PDF export with smart formatting                               | Integrate PDF generation library (@react-pdf/renderer or jsPDF with html2canvas). Implement intelligent page breaks, professional layout, clickable hyperlinks, and table of contents.           | Advanced Features & Refinements        | Pending     |
| GHI-46  | EPIC 7: Export Features            | Markdown Export          | Implement Markdown export functionality                                  | Add "Export as Markdown" button to ReportDisplay component. Preserve formatting, tables, and links. Include metadata and implement proper naming convention for downloads.                       | Advanced Features & Refinements        | Pending     |
| GHI-47  | EPIC 4: Semantic Search            | RAG Design               | Finalize RAG architecture implementation details                         | Define vector database integration strategy (client-side vs server-side), embedding generation approach, and context retrieval strategy for granular report section search.                      | URL Processing & Basic Semantic Search | Pending     |
| GHI-48  | EPIC 6: NFRs & Chores              | Prompt Engineering       | Implement provider-specific prompt optimization                          | Map prompts.ts constants to their usage locations and adjust prompts for optimal performance across different AI providers (OpenAI, Gemini, OpenRouter).                                         | Advanced Features & Refinements        | Pending     |
| GHI-49  | EPIC 8: UI/UX Enhancements         | Cognitive Load UI        | Enhanced UI/UX with cognitive load management                            | Implement UI improvements focused on reducing cognitive load, improving information hierarchy, and enhancing user experience during SIFT analysis workflows.                                     | Advanced Features & Refinements        | Pending     |
| GHI-50  | EPIC 9: Dockerization              | Docker Compose           | Finalize docker-compose.yml for frontend/backend/database orchestration. | Ensure docker-compose.yml correctly defines services, build contexts, ports, volumes, environment variables, and dependencies for seamless orchestration.                                        | Dockerized Release                     | Pending     |
| GHI-51  | EPIC 9: Dockerization              | Dockerfile (Backend)     | Complete and test backend Dockerfile.                                    | Verify backend Dockerfile builds correctly, includes all dependencies, and sets up the environment for the Sinatra application.                                                                  | Dockerized Release                     | Pending     |
| GHI-52  | EPIC 9: Dockerization              | Dockerfile (Frontend)    | Complete and test frontend Dockerfile.                                   | Verify frontend Dockerfile builds correctly, includes all dependencies, and sets up the environment for the React application.                                                                   | Dockerized Release                     | Pending     |
| GHI-53  | EPIC 9: Dockerization              | Environment Variables    | Ensure environment variables are correctly handled in Docker.            | Verify environment variables are loaded and used correctly by both frontend and backend services within their Docker containers.                                                                 | Dockerized Release                     | Pending     |
| GHI-54  | EPIC 9: Dockerization              | Entrypoint Scripts       | Finalize and test docker-entrypoint.sh.                                  | Ensure docker-entrypoint.sh correctly sets up the environment and starts the application processes within the backend container.                                                                 | Dockerized Release                     | Pending     |
| GHI-55  | EPIC 9: Dockerization              | Testing                  | Test docker-compose up -d functionality.                                 | Verify that running `docker-compose up -d` successfully builds (if necessary) and starts all services, making the application accessible.                                                        | Dockerized Release                     | Pending     |
| GHI-56  | EPIC 4: Semantic Search            | Chunking Strategy        | Define and implement chunking strategy for extracted URL content.        | Determine and implement the optimal strategy (e.g., paragraph, content-aware) for breaking down extracted URL text into semantically meaningful chunks for embedding and search.                 | URL Processing & Basic Semantic Search | Pending     |
| GHI-57  | EPIC 4: Semantic Search            | Chunking Strategy        | Define and implement chunking strategy for SIFT report sections.         | Determine and implement the optimal strategy for breaking down SIFT analysis reports into manageable and semantically cohesive chunks for embedding and search.                                  | Advanced Features & Refinements        | Pending     |
| GHI-58  | EPIC 4: Semantic Search            | Search Logic Refinement  | Refine semantic search logic to operate on chunks.                       | Modify the backend search logic to perform similarity search against the embeddings of text chunks (from URLs and SIFT reports) and return chunk-level results.                                  | URL Processing & Basic Semantic Search | Pending     |
| GHI-59  | EPIC 4: Semantic Search            | Client UI Enhancement    | Update client search UI to display chunk-level results.                  | Modify the client-side search interface to handle and display search results at the chunk level, including linking back to the original document and potentially highlighting the relevant text. | Advanced Features & Refinements        | Pending     |
| GHI-60  | EPIC 4: Semantic Search            | Context Assembly (RAG)   | Implement logic to assemble retrieved chunks for RAG prompts.            | Develop the backend logic to select the top-k most relevant text chunks from search results and format them as context for Retrieval-Augmented Generation (RAG) prompts sent to the LLM.         | Conversational SIFT & Full Persistence | Pending     |